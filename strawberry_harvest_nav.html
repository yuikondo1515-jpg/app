<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒã‚´åç©«ãƒŠãƒ“ - Strawberry Harvest Nav</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&display=swap');
        
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #fffafb;
            background-image: radial-gradient(#ffdfdf 1.5px, transparent 1.5px);
            background-size: 24px 24px;
            height: 100vh;
            overflow: hidden;
        }

        .strawberry-gradient {
            background: linear-gradient(135deg, #ff4d6d 0%, #d90429 100%);
        }

        .berry-shape {
            border-radius: 3rem;
        }

        .header-curve {
            border-bottom-left-radius: 3.5rem;
            border-bottom-right-radius: 3.5rem;
        }

        .video-container {
            position: relative;
            overflow: hidden;
            border-radius: 3.5rem;
            border: 8px solid #fff;
            box-shadow: 0 20px 50px rgba(217, 4, 41, 0.15);
        }

        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, #fff, transparent);
            box-shadow: 0 0 15px #fff;
            animation: scan 3s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes scan {
            0% { top: 15%; opacity: 0; }
            50% { top: 50%; opacity: 1; }
            100% { top: 85%; opacity: 0; }
        }

        .btn-pop {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 0 #8d021b;
        }
        .btn-pop:active {
            transform: translateY(4px);
            box-shadow: 0 4px 0 #8d021b;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .camera-berry {
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }

        /* ãƒãƒƒãƒ—ä¸Šã®ã‚¤ãƒã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .map-berry {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }
        .map-berry:active {
            transform: scale(1.4);
        }

        /* è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .pop-up {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* å“ç¨®ã‚¬ã‚¤ãƒ‰ã®ã‚«ãƒ¼ãƒ‰ã‚¹ãƒ©ã‚¤ãƒ‰ */
        .guide-scroll {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 1rem;
            padding: 0.5rem;
        }
        .guide-card {
            flex: 0 0 85%;
            scroll-snap-align: center;
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app" class="max-w-md mx-auto h-screen bg-white/80 backdrop-blur-sm shadow-2xl flex flex-col relative overflow-hidden">
        
        <!-- Header -->
        <header class="strawberry-gradient p-6 text-white header-curve shadow-xl z-20 relative">
            <div class="flex justify-between items-center">
                <div class="flex flex-col">
                    <h1 class="text-2xl font-black tracking-tighter flex items-center gap-2">
                        <span class="drop-shadow-lg">ğŸ“</span> ã„ã¡ã”ãƒŠãƒ“
                    </h1>
                    <span class="text-[10px] font-bold opacity-80 ml-1">Harvest Helper v2.0</span>
                </div>
                <div id="auth-status" class="text-[9px] bg-white/20 backdrop-blur-md px-3 py-1 rounded-full font-black border border-white/30">
                    ONLINE
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow p-6 overflow-y-auto no-scrollbar pb-28">
            
            <!-- Home View -->
            <div id="home-view" class="space-y-6">
                <!-- Status Cards -->
                <div class="flex gap-4">
                    <div class="flex-grow bg-white berry-shape p-5 shadow-lg border-b-4 border-red-100 flex flex-col items-center">
                        <p class="text-[10px] text-red-400 font-black mb-1">æœ¬æ—¥ã®åç©«é«˜</p>
                        <div class="flex items-baseline gap-1">
                            <span id="count-display" class="text-4xl font-black text-red-600">0</span>
                            <span class="text-sm font-bold text-red-400">ç²’</span>
                        </div>
                    </div>
                    <div class="w-24 bg-green-50 berry-shape p-5 shadow-lg border-b-4 border-green-100 flex flex-col items-center justify-center">
                        <span class="text-2xl mb-1">ğŸƒ</span>
                        <p class="text-[9px] font-black text-green-600">åŒæœŸä¸­</p>
                    </div>
                </div>

                <!-- Main Action Button -->
                <div class="relative group">
                    <div class="absolute -inset-1 bg-gradient-to-r from-red-500 to-pink-500 rounded-[3.5rem] blur opacity-25 group-hover:opacity-50 transition duration-1000"></div>
                    <button onclick="switchView('scan')" class="relative w-full strawberry-gradient btn-pop text-white py-12 berry-shape flex flex-col items-center justify-center gap-4 overflow-hidden">
                        
                        <div class="absolute top-2 left-4 opacity-20 text-3xl rotate-12">ğŸ“</div>
                        <div class="absolute bottom-2 right-4 opacity-20 text-3xl -rotate-12">ğŸ“</div>
                        
                        <div class="bg-white/20 p-5 rounded-full shadow-inner relative z-10 camera-berry">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M7 8C5.89543 8 5 8.89543 5 10V16C5 17.1046 5.89543 18 7 18H17C18.1046 18 19 17.1046 19 16V10C19 8.89543 18.1046 8 17 8H15.5C15.15 8 14.85 7.8 14.65 7.5L13.85 6.3C13.5 5.8 13 5.5 12.4 5.5H11.6C11 5.5 10.5 5.8 10.15 6.3L9.35 7.5C9.15 7.8 8.85 8 8.5 8H7Z" fill="white"/>
                                <circle cx="12" cy="13" r="3.5" fill="#d90429" stroke="white" stroke-width="1.5"/>
                                <path d="M10 6C10.5 4.5 12 4 12 4C12 4 13.5 4.5 14 6" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                <circle cx="13.5" cy="11.5" r="0.8" fill="white"/>
                            </svg>
                        </div>

                        <div class="text-center z-10">
                            <span class="text-2xl font-black tracking-widest block drop-shadow-md">åˆ¤å®šã‚«ãƒ¡ãƒ©èµ·å‹•</span>
                            <span class="text-[10px] font-bold opacity-80 uppercase mt-1 inline-block">Tap to Scan Strawberry</span>
                        </div>
                    </button>
                </div>

                <!-- Map Area -->
                <div class="bg-white berry-shape p-6 shadow-xl border border-red-50 relative">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-black text-red-500 flex items-center gap-2">
                            <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                            ã‚¨ãƒªã‚¢ç†Ÿåº¦åˆ†å¸ƒ
                        </h3>
                        <span class="text-[9px] font-bold text-gray-400">ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—!</span>
                    </div>
                    <div class="aspect-video bg-red-50/50 rounded-3xl border-2 border-dashed border-red-100 relative overflow-hidden">
                        <!-- Map dots as clickable strawberries -->
                        <div onclick="showDetail('Aæ£Ÿ 3ç•ªé€šè·¯', 'ç´…ã»ã£ãº', 'ç†Ÿåº¦ 90% (åç©«æœŸ)')" class="map-berry absolute" style="top:25%; left:20%; font-size: 1.5rem;">ğŸ“</div>
                        <div onclick="showDetail('Bæ£Ÿ 1ç•ªé€šè·¯', 'ã¨ã¡ãŠã¨ã‚', 'ç†Ÿåº¦ 60% (æ˜æ—¥ä»¥é™)')" class="map-berry absolute" style="top:65%; left:45%; font-size: 1.2rem; filter: saturate(0.5);">ğŸ“</div>
                        <div onclick="showDetail('Aæ£Ÿ 12ç•ªé€šè·¯', 'ç´…ã»ã£ãº', 'ç†Ÿåº¦ 95% (å³åç©«!)')" class="map-berry absolute" style="top:35%; left:75%; font-size: 1.6rem;">ğŸ“</div>
                        <div onclick="showDetail('Cæ£Ÿ 5ç•ªé€šè·¯', 'ç« å§«', 'ç†Ÿåº¦ 30% (æœªç†Ÿ)')" class="map-berry absolute" style="top:15%; left:60%; font-size: 1.1rem; filter: grayscale(0.8);">ğŸ“</div>
                    </div>

                    <!-- Detail Pop-up -->
                    <div id="map-detail" class="pop-up absolute inset-x-6 bottom-6 bg-white rounded-3xl shadow-2xl border-2 border-red-500 p-4 translate-y-full opacity-0 pointer-events-none z-40">
                        <div class="flex items-start justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-3xl">ğŸ </span>
                                <div>
                                    <p id="detail-house" class="text-xs font-black text-red-400 uppercase tracking-tighter">--</p>
                                    <p id="detail-variety" class="text-lg font-black text-gray-800">--</p>
                                    <p id="detail-status" class="text-[10px] font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded-full inline-block mt-1">--</p>
                                </div>
                            </div>
                            <button onclick="hideDetail()" class="text-gray-300 hover:text-red-500 p-1">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M18 6 6 18M6 6l12 12"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scan View -->
            <div id="scan-view" class="hidden h-full flex flex-col space-y-4">
                <div class="flex justify-between items-center">
                    <button onclick="switchView('home')" class="bg-white text-red-500 font-black px-6 py-2 rounded-full shadow-md border border-red-50 flex items-center gap-2 text-sm">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg> æˆ»ã‚‹
                    </button>
                    <div class="bg-red-500 text-white text-[10px] font-black px-4 py-1.5 rounded-full shadow-lg flex items-center gap-2">
                        <span class="w-1.5 h-1.5 bg-white rounded-full animate-ping"></span>
                        AI ANALYZING...
                    </div>
                </div>

                <div class="video-container flex-grow">
                    <video id="webcam" autoplay playsinline class="w-full h-full object-cover"></video>
                    <div class="scan-line"></div>
                    
                    <div id="detection-result" class="absolute bottom-8 left-1/2 -translate-x-1/2 bg-white/95 backdrop-blur px-10 py-4 rounded-full shadow-2xl border-4 border-red-500 min-w-[220px] text-center">
                        <p class="text-[9px] font-black text-red-300 uppercase mb-1">Strawberry Status</p>
                        <span id="result-label" class="text-2xl font-black text-red-600">ã‚¹ã‚­ãƒ£ãƒ³ä¸­...</span>
                    </div>
                </div>

                <button id="capture-btn" class="w-full strawberry-gradient btn-pop text-white py-6 berry-shape font-black text-xl flex items-center justify-center gap-3">
                    <span class="text-3xl">ğŸ“</span> åç©«ã‚’è¨˜éŒ²
                </button>
            </div>

            <!-- History View -->
            <div id="history-view" class="hidden space-y-6">
                <!-- å“ç¨®ã‚¬ã‚¤ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <section>
                    <h3 class="text-sm font-black text-red-500 mb-3 flex items-center gap-2 px-2">
                        <span>ğŸ“–</span> ã„ã¡ã”å“ç¨®ã‚¬ã‚¤ãƒ‰
                    </h3>
                    <div class="guide-scroll no-scrollbar">
                        <!-- ç´…ã»ã£ãº -->
                        <div class="guide-card bg-white p-4 rounded-[2.5rem] shadow-md border border-red-50 flex flex-col items-center">
                            <span class="text-4xl mb-2">ğŸ“</span>
                            <h4 class="font-black text-gray-800">ç´…ã»ã£ãº</h4>
                            <p class="text-[9px] text-red-400 font-bold mb-2 tracking-widest">Beni-hoppe</p>
                            <p class="text-[10px] text-center text-gray-500 leading-relaxed font-bold">
                                ç”˜ã¿ã¨é…¸å‘³ã®ãƒãƒ©ãƒ³ã‚¹ãŒæŠœç¾¤ã€‚<br>ã‚³ã‚¯ã®ã‚ã‚‹æ·±ã„å‘³ã‚ã„ãŒç‰¹å¾´ã§ã™ã€‚
                            </p>
                        </div>
                        <!-- ç« å§« -->
                        <div class="guide-card bg-white p-4 rounded-[2.5rem] shadow-md border border-red-50 flex flex-col items-center">
                            <span class="text-4xl mb-2">ğŸ“</span>
                            <h4 class="font-black text-gray-800">ç« å§«</h4>
                            <p class="text-[9px] text-pink-400 font-bold mb-2 tracking-widest">Akihime</p>
                            <p class="text-[10px] text-center text-gray-500 leading-relaxed font-bold">
                                é…¸å‘³ãŒå°‘ãªãã€ç”˜ã¿ãŒå¼·ã„ã€‚<br>é•·ã‚ã®å½¢ãŒç‰¹å¾´ã§æœè‚‰ãŒæŸ”ã‚‰ã‹ã„ã€‚
                            </p>
                        </div>
                        <!-- ã¨ã¡ãŠã¨ã‚ -->
                        <div class="guide-card bg-white p-4 rounded-[2.5rem] shadow-md border border-red-50 flex flex-col items-center">
                            <span class="text-4xl mb-2">ğŸ“</span>
                            <h4 class="font-black text-gray-800">ã¨ã¡ãŠã¨ã‚</h4>
                            <p class="text-[9px] text-orange-400 font-bold mb-2 tracking-widest">Tochi-otome</p>
                            <p class="text-[10px] text-center text-gray-500 leading-relaxed font-bold">
                                é¦™ã‚Šé«˜ãã€æœå®ŸãŒã—ã£ã‹ã‚Šã€‚<br>æ—¥æŒã¡ãŒè‰¯ãã€é®®ã‚„ã‹ãªèµ¤è‰²ãŒé­…åŠ›ã€‚
                            </p>
                        </div>
                    </div>
                </section>

                <!-- åç©«å±¥æ­´ãƒªã‚¹ãƒˆ -->
                <section class="space-y-4">
                    <div class="bg-red-500 p-6 berry-shape text-white shadow-lg flex justify-between items-center">
                        <div>
                            <h2 class="text-xl font-black">åç©«å›³é‘‘</h2>
                            <p class="text-[10px] opacity-80 font-bold">Your Harvest Collection</p>
                        </div>
                        <div id="history-stats" class="bg-white text-red-500 font-black px-4 py-2 rounded-2xl shadow-inner">
                            0 ç²’
                        </div>
                    </div>
                    <div id="history-list" class="space-y-3"></div>
                </section>
            </div>
        </main>

        <!-- Navigation -->
        <nav class="absolute bottom-0 w-full bg-white/90 backdrop-blur-md border-t-2 border-red-50 px-8 py-5 flex justify-around items-center z-30 rounded-t-[3rem] shadow-[0_-10px_40px_rgba(217,4,41,0.05)]">
            <button onclick="switchView('home')" id="nav-home" class="flex flex-col items-center gap-1 text-red-500 scale-110 transition-all">
                <div class="p-2 rounded-2xl bg-red-50">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="m12 3 8 7v11a1 1 0 0 1-1 1h-5v-6h-4v6H5a1 1 0 0 1-1-1V10l8-7z"/></svg>
                </div>
                <span class="text-[10px] font-black">ãƒ›ãƒ¼ãƒ </span>
            </button>
            <button onclick="switchView('scan')" id="nav-scan" class="flex flex-col items-center gap-1 text-gray-300">
                <div class="p-2 rounded-2xl">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <rect x="3" y="8" width="18" height="12" rx="2" stroke-width="3"/>
                        <path d="M9 8V6a3 3 0 0 1 6 0v2" stroke-width="2"/>
                        <circle cx="12" cy="14" r="2" stroke-width="2"/>
                    </svg>
                </div>
                <span class="text-[10px] font-black">åˆ¤å®š</span>
            </button>
            <button onclick="switchView('history')" id="nav-history" class="flex flex-col items-center gap-1 text-gray-300">
                <div class="p-2 rounded-2xl">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1-2.5-2.5Z"/><path d="M8 7h6M8 11h8"/></svg>
                </div>
                <span class="text-[10px] font-black">å›³é‘‘</span>
            </button>
        </nav>

        <!-- Toast Notification -->
        <div id="toast" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 scale-50 opacity-0 pointer-events-none transition-all duration-500 z-50 bg-white p-8 berry-shape border-8 border-red-500 shadow-2xl text-center">
            <span class="text-6xl block mb-4 animate-bounce">ğŸ“âœ¨</span>
            <p id="toast-text" class="text-xl font-black text-red-600">ãƒŠã‚¤ã‚¹åç©«ï¼</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'strawberry-harvest-app';

        let currentUser = null;
        let currentStatus = "åç©«æœ€é©";
        let stream = null;

        const countDisplay = document.getElementById('count-display');
        const historyList = document.getElementById('history-list');
        const statsDisplay = document.getElementById('history-stats');
        const resultLabel = document.getElementById('result-label');

        async function initAuth() {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        }

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                subscribeToHarvests(user.uid);
            }
        });

        function subscribeToHarvests(userId) {
            const harvestsCol = collection(db, 'artifacts', appId, 'users', userId, 'harvests');
            onSnapshot(query(harvestsCol), (snapshot) => {
                const harvests = [];
                snapshot.forEach(doc => harvests.push({ id: doc.id, ...doc.data() }));
                harvests.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                updateUI(harvests);
            }, (err) => console.error(err));
        }

        async function saveHarvest() {
            if (!currentUser) return;
            const btn = document.getElementById('capture-btn');
            btn.disabled = true;
            try {
                const harvestsCol = collection(db, 'artifacts', appId, 'users', currentUser.uid, 'harvests');
                // ãƒ©ãƒ³ãƒ€ãƒ ãªå“ç¨®ã§ä¿å­˜ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
                const varieties = ["ç´…ã»ã£ãº", "ç« å§«", "ã¨ã¡ãŠã¨ã‚"];
                const randomVariety = varieties[Math.floor(Math.random() * varieties.length)];
                
                await addDoc(harvestsCol, {
                    variety: randomVariety,
                    status: currentStatus,
                    createdAt: serverTimestamp()
                });
                showToast("åç©«ã‚’è¨˜éŒ²ã—ãŸã‚ˆï¼");
            } catch (error) {
                console.error(error);
            } finally {
                btn.disabled = false;
            }
        }

        function updateUI(harvests) {
            countDisplay.innerText = harvests.length;
            statsDisplay.innerText = `${harvests.length} ç²’`;
            if (harvests.length > 0) {
                historyList.innerHTML = harvests.map(item => {
                    const date = item.createdAt ? new Date(item.createdAt.seconds * 1000) : new Date();
                    const isOptimal = item.status === 'åç©«æœ€é©';
                    return `
                        <div class="bg-white p-4 berry-shape shadow-md flex justify-between items-center border-l-8 ${isOptimal ? 'border-red-500' : 'border-orange-400'}">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">ğŸ“</span>
                                <div>
                                    <p class="font-black text-sm text-gray-800">${item.variety}</p>
                                    <p class="text-[9px] text-gray-400 font-bold uppercase tracking-widest">
                                        ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                    </p>
                                </div>
                            </div>
                            <span class="text-[9px] font-black px-3 py-1 rounded-full ${isOptimal ? 'bg-red-100 text-red-600' : 'bg-orange-100 text-orange-600'}">
                                ${item.status}
                            </span>
                        </div>
                    `;
                }).join('');
            } else {
                historyList.innerHTML = `<div class="py-20 text-center opacity-20"><span class="text-6xl">ğŸ“</span><p class="font-black mt-4">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p></div>`;
            }
        }

        async function initCamera() {
            const video = document.getElementById('webcam');
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { ideal: "environment" } } });
                video.srcObject = stream;
            } catch (err) { console.error(err); }
        }

        window.switchView = function(viewName) {
            ['home', 'scan', 'history'].forEach(v => {
                document.getElementById(v + '-view').classList.add('hidden');
                document.getElementById('nav-' + v).classList.remove('text-red-500', 'scale-110');
                document.getElementById('nav-' + v).classList.add('text-gray-300');
                document.getElementById('nav-' + v).querySelector('div').classList.remove('bg-red-50');
            });
            document.getElementById(viewName + '-view').classList.remove('hidden');
            document.getElementById('nav-' + viewName).classList.add('text-red-500', 'scale-110');
            document.getElementById('nav-' + viewName).classList.remove('text-gray-300');
            document.getElementById('nav-' + viewName).querySelector('div').classList.add('bg-red-50');

            if (viewName === 'scan') {
                initCamera();
                startDetection();
            } else if (stream) {
                stream.getTracks().forEach(t => t.stop());
            }
        }

        window.showDetail = function(house, variety, status) {
            const popup = document.getElementById('map-detail');
            document.getElementById('detail-house').innerText = house;
            document.getElementById('detail-variety').innerText = variety;
            document.getElementById('detail-status').innerText = status;
            
            popup.classList.remove('translate-y-full', 'opacity-0', 'pointer-events-none');
            popup.classList.add('translate-y-0', 'opacity-100', 'pointer-events-auto');
        }

        window.hideDetail = function() {
            const popup = document.getElementById('map-detail');
            popup.classList.add('translate-y-full', 'opacity-0', 'pointer-events-none');
            popup.classList.remove('translate-y-0', 'opacity-100', 'pointer-events-auto');
        }

        function startDetection() {
            const statuses = ["åç©«æœ€é©", "ã‚‚ã†å°‘ã—", "ã¾ã é’ã„"];
            let i = 0;
            const timer = setInterval(() => {
                if (document.getElementById('scan-view').classList.contains('hidden')) return clearInterval(timer);
                currentStatus = statuses[i % 3];
                resultLabel.innerText = currentStatus;
                i++;
            }, 2500);
        }

        function showToast(text) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-text').innerText = text;
            toast.classList.remove('opacity-0', 'scale-50');
            toast.classList.add('opacity-100', 'scale-100');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'scale-50');
                toast.classList.remove('opacity-100', 'scale-100');
            }, 2000);
        }

        document.getElementById('capture-btn').addEventListener('click', saveHarvest);
        window.addEventListener('load', initAuth);
    </script>
</body>
</html>
